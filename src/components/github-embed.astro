---
import { Code } from 'astro:components';

import { fetchWithCache } from '~/scripts/server/github-embed/github-embed.fetch.js';
import { extractLines, parseGitHubUrl } from '~/scripts/server/github-embed/github-embed.util.js';

interface Props {
  githubUrl: string;
}

const { githubUrl } = Astro.props;

const parsedUrl = parseGitHubUrl(githubUrl);
const fetchResult = await fetchWithCache(parsedUrl);
const code = extractLines(fetchResult.content, parsedUrl.lineRange);
const { language } = parsedUrl;
---
{ /* @ts-expect-error Astro sets lang to a type that it doesn't export. I'm not interested in recreating the type for this. */ }
<Code code={code} lang={language} />
